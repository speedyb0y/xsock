#!/bin/bash

ISP_MTU=1492

#(make && insmod xsock-srv.ko)

#echo scalable > /proc/sys/net/ipv4/tcp_congestion_control
echo 4096 > /proc/sys/net/ipv4/tcp_max_reordering
echo 300 > /proc/sys/net/ipv4/tcp_reordering
echo 1 > /proc/sys/net/ipv6/conf/xsock/disable_ipv6
#echo 1 > /proc/sys/net/ipv4/tcp_fwmark_accept

# TODO: FIXME: REMOVE O BBR
# TODO: FIXME: REMOVE AQUELE SCALING

#tc qdisc  replace dev eth0 root pfifo_fast
#ip link set dev eth0 txqueuelen 65536

ip link set dev xsock up

ip -4 addr add dev xsock 172.16.0.0/24 noprefixroute
ip -4 rule add priority 2 table 5 to 172.16.0.0/24
ip -4 rule add priority 3 table 5 from 172.16.0.0/24
ip -4 rule add priority 4 table 5 oif xsock
ip -4 route add table 5 dev xsock mtu $[${ISP_MTU}-4] advmss $[${ISP_MTU}-4-40] src 172.16.0.0 172.16.0.0/24 rtt 210ms rto_min 400ms
